##Plotting results of gradient forest / genetic offset
library(ggplot2)
library(maps) # tool for maps
library(mapdata) # all your basemaps are here
#library(ggrepel)
library(patchwork)

setwd("~/Desktop/Sarah/Salmon/GenomicVulnerability/")

northam <-read.csv("GradientForest_AllSalmonRivers/Order_of_Sites_NASCO_enviro.csv", header=T)
northam[which(northam$Nasco!="LOST"),]

rcp26 <- read.table("GradientForest_AllSalmonRivers/GeneticOffset_RCP26_6enviro_allRivers.txt", header=T)
rcp45 <- read.table("GradientForest_AllSalmonRivers/GeneticOffset_RCP45_6enviro_allRivers.txt", header=T)
rcp60 <- read.table("GradientForest_AllSalmonRivers/GeneticOffset_RCP60_6enviro_allRivers.txt", header=T)
rcp85 <- read.table("GradientForest_AllSalmonRivers/GeneticOffset_RCP85_6enviro_allRivers.txt", header=T)

all_gen_offset <- as.data.frame(cbind(northam, rcp26[!is.na(rcp26$Genoffset_RCP26),],
                                      "Genoffset_RCP45"=rcp45[!is.na(rcp45$Genoffset_RCP45),2], 
                                     "Genoffset_RCP60"=rcp60[!is.na(rcp60$Genoffset_RCP60),2],
                                     "Genoffset_RCP85"=rcp85[!is.na(rcp85$Genoffset_RCP85),2]))

all_gen_offset


world <- map_data("world")
plot_rcp26 <- ggplot()+ 
  geom_map(data=world, map=world,
           aes(x=long, y=lat, map_id=region),
           color="white", size=0.1, fill="gray10")+
  scale_x_continuous(limits = c(-78,-50), expand = c(0, 0)) +
  scale_y_continuous(limits = c(43,60), expand = c(0, 0)) +
  theme_bw()+theme(panel.grid = element_blank())+
  geom_point(data=all_gen_offset[order(all_gen_offset$Genoffset_RCP26, decreasing = T),],
             aes(x=Long.1, y=Lat, fill=Genoffset_RCP26, size=Genoffset_RCP26),
             col="black", pch=21)+
  scale_size(limits = c(0.01, 0.21), range=c(0.01,5))+
  scale_fill_gradientn(colours=c("palegreen", "red"), limits=c(0.01, 0.21))+
  geom_text(aes(x=-52, y=59.6, label="RCP2.6"), size=3)  
  #geom_text_repel(data=all_gen_offset, aes(x=Long.1, y=Lat, label=Rivername),
          #        size=3)+
  NULL  
  
  
plot_rcp45 <- ggplot()+ 
    geom_map(data=world, map=world,
             aes(x=long, y=lat, map_id=region),
             color="white", size=0.1, fill="gray10")+
  scale_x_continuous(limits = c(-78,-50), expand = c(0, 0)) +
    scale_y_continuous(limits = c(43,60), expand = c(0, 0)) +
    theme_bw()+theme(panel.grid = element_blank())+
    geom_point(data=all_gen_offset[order(all_gen_offset$Genoffset_RCP45, decreasing = T),],
               aes(x=Long.1, y=Lat, fill=Genoffset_RCP45, size=Genoffset_RCP45),
               col="black", pch=21)+
  scale_size(limits = c(0.01, 0.21), range=c(0.01,5))+
  scale_fill_gradientn(colours=c("palegreen", "red"), limits=c(0.01, 0.21))+
  geom_text(aes(x=-52, y=59.6, label="RCP4.5"), size=3)  
  #geom_text_repel(data=all_gen_offset, aes(x=Long.1, y=Lat, label=Rivername),
  #        size=3)+
  NULL  
  

plot_rcp60 <- ggplot()+ 
    geom_map(data=world, map=world,
             aes(x=long, y=lat, map_id=region),
             color="white", size=0.1, fill="gray10")+
  scale_x_continuous(limits = c(-78,-50), expand = c(0, 0)) +
    scale_y_continuous(limits = c(43,60), expand = c(0, 0)) +
    theme_bw()+theme(panel.grid = element_blank())+
    geom_point(data=all_gen_offset[order(all_gen_offset$Genoffset_RCP60, decreasing = T),],
               aes(x=Long.1, y=Lat, fill=Genoffset_RCP60, size=Genoffset_RCP60),
               col="black", pch=21)+
  scale_size(limits = c(0.01, 0.21), range=c(0.01,5))+
  scale_fill_gradientn(colours=c("palegreen", "red"), limits=c(0.01, 0.21))+
geom_text(aes(x=-52, y=59.6, label="RCP6.0"), size=3)  
  #geom_text_repel(data=all_gen_offset, aes(x=Long.1, y=Lat, label=Rivername),
  #        size=3)+
  NULL 
  
plot_rcp85 <- ggplot()+ 
    geom_map(data=world, map=world,
             aes(x=long, y=lat, map_id=region),
             color="white", size=0.1, fill="gray10")+
    scale_x_continuous(limits = c(-78,-50), expand = c(0, 0)) +
    scale_y_continuous(limits = c(43,60), expand = c(0, 0)) +
    theme_bw()+theme(panel.grid = element_blank())+
    geom_point(data=all_gen_offset[order(all_gen_offset$Genoffset_RCP85, decreasing = T),],
               aes(x=Long.1, y=Lat, fill=Genoffset_RCP85, size=Genoffset_RCP85),
               col="black", pch=21)+
    scale_size(limits = c(0.01, 0.21), range=c(0.01,5))+
    scale_fill_gradientn(colours=c("palegreen", "red"),  limits=c(0.01, 0.21))+
geom_text(aes(x=-52, y=59.6, label="RCP8.5"), size=3)  
#geom_text_repel(data=all_gen_offset, aes(x=Long.1, y=Lat, label=Rivername),
  #        size=3)+
  NULL  

#Patchwork plots: -- remove legends in illustrator -- need to keep one - but all should be the same colour /size (added limits) 
(plot_rcp26 | plot_rcp45)/(plot_rcp60 | plot_rcp85)
#save plot as large  14 x 11
