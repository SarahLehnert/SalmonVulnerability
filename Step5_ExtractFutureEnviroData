setwd("~/Desktop/Sarah/Salmon/GenomicVulnerability/")
library(rbioclim)
library(rgdal)
library(raster)
library(data.table)
library(tidyr)

outliers=fread("OutliersRDA_AlleleFrequencies.txt", header=T)
#outlier_allelefreq=spread(outliers[,c(2,3,6)], "SNP", "MAF")
dim(outliers)


bioclim = recursive.getData(times="all") # by default resolution 2.5m and the 19 bioclim variables. (but can be changed)

#Bioclim variables of interest: 

future_26=(bioclim[["CC2650"]])
bio_rcp26=future_26[[c("bio2", "bio8", "bio10",
                       "bio11", "bio13", "bio15")]]

future_45=(bioclim[["CC4550"]])
bio_rcp45=future_45[[c("bio2", "bio8", "bio10",
                       "bio11", "bio13", "bio15")]]

future_60=(bioclim[["CC6050"]])
bio_rcp60=future_60[[c("bio2", "bio8", "bio10",
                       "bio11", "bio13", "bio15")]]

future_85=(bioclim[["CC8550"]])
bio_rcp85=future_85[[c("bio2", "bio8", "bio10",
                       "bio11", "bio13", "bio15")]]

bioclim = recursive.getData(times="pres") # by default resolution 2.5m and the 19 bioclim variables. (but can be changed)
present=(bioclim[["pres"]])
bio_present=present[[c("bio2", "bio8", "bio10",
                       "bio11", "bio13", "bio15")]]

northam=read.csv("SiteInfo/All_siteLocations_NorthAmerican_UPDATED.csv", header=T)
head(northam)

#Merge site locations with SNP data (include a few things for site location info lat/long)
all_data=merge(northam[,c(1:3,6)], as.data.frame(outliers),  by=1)
all_data[1:10,1:10]
dim(all_data)

#change ARO -- location does not appear to be on land where Bioclim data is present
all_data$Long[which(all_data$Code=="ARO")] <- -66.93775
all_data$Lat[which(all_data$Code=="ARO")] <- 50.07073

#change LSR -- almost in ocean
all_data$Lat[which(all_data$Code=="LSR")] <- all_data$Lat[which(all_data$Code=="LSR")]+0.01

#Set coordinates to get data for
coordinates=cbind(all_data$Long, all_data$Lat)


#Extract datasets
bio_rcp26_future<- raster::extract(bio_rcp26, coordinates)
bio_rcp45_future<- raster::extract(bio_rcp45, coordinates)
bio_rcp60_future<- raster::extract(bio_rcp60, coordinates)
bio_rcp85_future<- raster::extract(bio_rcp85, coordinates)
bio_present_data <- raster::extract(bio_present, coordinates)

rcp26_save=as.data.frame(cbind(as.character(all_data$Code), bio_rcp26_future))
rcp45_save=as.data.frame(cbind(as.character(all_data$Code), bio_rcp45_future))
rcp60_save=as.data.frame(cbind(as.character(all_data$Code), bio_rcp60_future))
rcp85_save=as.data.frame(cbind(as.character(all_data$Code), bio_rcp85_future))
present_save=as.data.frame(cbind(as.character(all_data$Code), bio_present_data))



write.table(rcp26_save, "FutureEnviro/RCP26_future_selectEnviro.txt", quote=F, row.names = F, col.names = T, sep="\t")
write.table(rcp45_save, "FutureEnviro/RCP45_future_selectEnviro.txt", quote=F, row.names = F, col.names = T, sep="\t")
write.table(rcp60_save, "FutureEnviro/RCP60_future_selectEnviro.txt", quote=F, row.names = F, col.names = T, sep="\t")
write.table(rcp85_save, "FutureEnviro/RCP85_future_selectEnviro.txt", quote=F, row.names = F, col.names = T, sep="\t")
write.table(present_save, "FutureEnviro/present_selectEnviro.txt", quote=F, row.names = F, col.names = T, sep="\t")
