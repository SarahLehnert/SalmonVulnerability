#Create dataframe of North American individuals to subset
library(data.table)
library(tidyr)

#Open Frequency (long format) data - created using plink '--freq --family'
#Plink and bed file 
#
plink<-"~/Desktop/Software/plink_mac_20200219/"
bfile <-"~/Desktop/Sarah/Salmon/GenomicVulnerability/Combined_CAN_goodSNPs_allruns_badindremove_94K_updateIDs2_final_3838ind_maf005_recode" #don't inlcude .bed 

outlier_loci<-"~/Desktop/Sarah/Salmon/GenomicVulnerability/RDA/CandidateSNP_correlations_RDA_ListOnly.txt"

system(paste0("cd ", plink,"; ./plink --bfile ", bfile, " --extract ", outlier_loci," --freq --family --allow-extra-chr --chr-set 30 --out ", bfile,"AlleleFrequencies_Outliers") )

new_freq_path<-paste0(bfile,"AlleleFrequencies_Outliers.frq.strat")
freq=fread(input = new_freq_path, header=T)

#Change to wide foramt using spread() function
test=spread(data = freq[,c(2,3,6)],key = "SNP",value = "MAF")

#Save for RDA analysis - Population level allele frequencies
fwrite(test,"~/Desktop/Sarah/Salmon/GenomicVulnerability/OutliersRDA_AlleleFrequencies.txt", quote = F, row.names = F, col.names = T, sep="\t")
